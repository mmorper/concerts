<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gatefold Animation - Centered Fix</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Source Sans 3', system-ui, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      overflow: hidden;
    }

    /* Background grid */
    .background-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 0;
      width: 100vw;
      height: 100vh;
      transition: opacity 0.4s ease, filter 0.4s ease;
    }

    .background-grid.dimmed {
      opacity: 0.3;
      filter: blur(6px);
    }

    .tile {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8vw;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .tile:hover {
      transform: scale(1.03);
      z-index: 2;
    }

    .tile.hidden {
      opacity: 0;
    }

    /* Genre colors */
    .rock { background: #2563eb; }
    .alt { background: #dc2626; }
    .indie { background: #f97316; }
    .electronic { background: #22c55e; }
    .pop { background: #06b6d4; }
    .metal { background: #64748b; }
    .newwave { background: #8b5cf6; }
    .punk { background: #ec4899; }

    /* ========== FLYING TILE ========== */
    .flying-tile {
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      z-index: 150;
      pointer-events: none;
    }

    /* ========== GATEFOLD OVERLAY ========== */
    .gatefold-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 100;
      perspective: 2000px;
    }

    .gatefold-overlay.active {
      pointer-events: auto;
    }

    /* Gatefold wrapper - explicitly positioned, not flex-centered */
    .gatefold-wrapper {
      position: absolute;
      transform-style: preserve-3d;
      opacity: 0;
      /* Will be positioned via JS for proper centering */
    }

    .gatefold-wrapper.visible {
      opacity: 1;
    }

    /* The gatefold container - holds both panels */
    .gatefold {
      display: flex;
      transform-style: preserve-3d;
      position: relative;
    }

    /* ========== RIGHT PANEL (Spotify - always there, revealed by cover) ========== */
    .panel-right {
      width: 400px;
      height: 400px;
      background: linear-gradient(145deg, #121212 0%, #181818 100%);
      padding: 32px;
      display: flex;
      flex-direction: column;
      border-radius: 4px;
      box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.5),
        0 10px 20px rgba(0, 0, 0, 0.3);
      transform-style: preserve-3d;
      transform-origin: left center;
      transform: rotateY(0deg);
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    /* V-angle: right outer edge tilts TOWARD viewer */
    .gatefold-wrapper.open .panel-right {
      transform: rotateY(-15deg);
    }

    /* ========== THE COVER (becomes left panel when opened) ========== */
    .album-cover {
      position: absolute;
      top: 0;
      left: 0;
      width: 400px;
      height: 400px;
      transform-style: preserve-3d;
      transform-origin: left center; /* Hinged on left edge */
      z-index: 20;
      cursor: pointer;
      transform: rotateY(0deg);
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Cover opened - swung open to the left, becomes left panel */
    .gatefold-wrapper.open .album-cover {
      transform: rotateY(-165deg);
    }

    /* Front of cover (album art - visible when closed) */
    .cover-front {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      backface-visibility: hidden;
      border-radius: 4px;
      box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.5),
        0 10px 20px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    /* Back of cover (inside - artist info, visible when opened) */
    .cover-back {
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg, #181818 0%, #121212 100%);
      padding: 32px;
      display: flex;
      flex-direction: column;
      backface-visibility: hidden;
      transform: rotateY(180deg);
      border-radius: 4px;
      box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.5),
        0 10px 20px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    /* ========== SPINE (appears between panels when open) ========== */
    .spine {
      position: absolute;
      left: -6px;
      top: 0;
      width: 12px;
      height: 400px;
      background: linear-gradient(
        to right,
        #0a0a0a 0%,
        #1a1a1a 20%,
        #0a0a0a 50%,
        #1a1a1a 80%,
        #0a0a0a 100%
      );
      box-shadow: 
        inset 0 0 10px rgba(0, 0, 0, 0.8);
      z-index: 15;
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .gatefold-wrapper.open .spine {
      opacity: 1;
      transition-delay: 0.3s;
    }

    .spine::before {
      content: '';
      position: absolute;
      top: 10px;
      bottom: 10px;
      left: 50%;
      width: 2px;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(0,0,0,0.6) 10%,
        rgba(0,0,0,0.6) 90%,
        transparent 100%
      );
      transform: translateX(-50%);
    }

    /* ========== CONTENT STYLES ========== */
    .artist-header {
      display: flex;
      gap: 20px;
      margin-bottom: 28px;
      flex-shrink: 0;
    }

    .album-art-placeholder {
      width: 100px;
      height: 100px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Source Sans 3', sans-serif;
      font-size: 2.25rem;
      font-weight: 600;
      color: white;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      flex-shrink: 0;
    }

    .artist-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .artist-name {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: #ffffff;
      letter-spacing: -0.01em;
      line-height: 1.15;
      margin-bottom: 8px;
    }

    .artist-meta {
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.9rem;
      color: #a3a3a3;
      font-weight: 400;
    }

    .concert-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
    }

    .section-label {
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      color: #1DB954;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 14px;
      flex-shrink: 0;
    }

    .concert-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: hidden;
    }

    .concert-item {
      display: flex;
      align-items: baseline;
      gap: 16px;
      font-size: 0.95rem;
      color: #e5e5e5;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .concert-item:last-child {
      border-bottom: none;
    }

    .concert-date {
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.8rem;
      color: #737373;
      font-weight: 500;
      font-variant-numeric: tabular-nums;
      min-width: 85px;
      flex-shrink: 0;
    }

    .concert-venue {
      font-family: 'Source Sans 3', sans-serif;
      color: #e5e5e5;
      font-weight: 400;
    }

    /* Spotify section */
    .spotify-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
    }

    .spotify-label {
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      color: #1DB954;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .spotify-icon {
      width: 18px;
      height: 18px;
    }

    .spotify-embed-container {
      flex: 1;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      min-height: 0;
    }

    .mock-track-list {
      width: 100%;
      height: 100%;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      background: #121212;
      overflow: hidden;
    }

    .play-icon {
      width: 32px;
      height: 32px;
      background: #1DB954;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(29, 185, 84, 0.3);
      flex-shrink: 0;
    }

    .play-icon svg {
      width: 14px;
      height: 14px;
      fill: #000;
      margin-left: 2px;
    }

    .mock-track {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .track-number {
      font-size: 0.9rem;
      color: #a3a3a3;
      width: 20px;
      text-align: center;
    }

    .track-art {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .track-info {
      flex: 1;
      min-width: 0;
    }

    .track-name {
      font-size: 0.95rem;
      font-weight: 500;
      color: #ffffff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track-artist {
      font-size: 0.8rem;
      color: #a3a3a3;
    }

    .track-duration {
      font-size: 0.85rem;
      color: #a3a3a3;
    }

    /* Close hint */
    .close-hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 101;
    }

    .close-hint.visible {
      opacity: 1;
    }

    /* Instructions */
    .instructions {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 16px 28px;
      border-radius: 12px;
      font-size: 0.95rem;
      color: #e5e5e5;
      z-index: 200;
      text-align: center;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .instructions strong {
      color: #1DB954;
    }

    .instructions .subtext {
      font-size: 0.8rem;
      color: #737373;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <!-- Background grid -->
  <div class="background-grid" id="bgGrid">
    <div class="tile alt" data-initials="AL" data-color="#dc2626">AL</div>
    <div class="tile rock" data-initials="AB" data-color="#2563eb">AB</div>
    <div class="tile rock" data-initials="AA" data-color="#2563eb">AA</div>
    <div class="tile rock" data-initials="AM" data-color="#2563eb">AM</div>
    <div class="tile rock" data-initials="AM" data-color="#2563eb">AM</div>
    <div class="tile electronic" data-initials="AT" data-color="#22c55e">AT</div>
    <div class="tile electronic" data-initials="AS" data-color="#22c55e">AS</div>
    <div class="tile pop" data-initials="AN" data-color="#06b6d4">AN</div>
    
    <div class="tile rock" data-initials="AN" data-color="#2563eb">AN</div>
    <div class="tile indie" data-initials="AF" data-color="#f97316">AF</div>
    <div class="tile electronic" data-initials="AS" data-color="#22c55e">AS</div>
    <div class="tile metal" data-initials="AW" data-color="#64748b">AW</div>
    <div class="tile rock" data-initials="BR" data-color="#2563eb">BR</div>
    <div class="tile indie" data-initials="BO" data-color="#f97316">BO</div>
    <div class="tile indie" data-initials="BA" data-color="#f97316">BA</div>
    <div class="tile alt" data-initials="BH" data-color="#dc2626">BH</div>
    
    <div class="tile alt" data-initials="BH" data-color="#dc2626">BH</div>
    <div class="tile metal" data-initials="BF" data-color="#64748b">BF</div>
    <div class="tile newwave" data-initials="BB" data-color="#8b5cf6">BB</div>
    <div class="tile pop" data-initials="BH" data-color="#06b6d4">BH</div>
    <div class="tile metal" data-initials="BB" data-color="#64748b">BB</div>
    <div class="tile metal" data-initials="BB" data-color="#64748b">BB</div>
    <div class="tile rock" data-initials="BE" data-color="#2563eb">BE</div>
    <div class="tile rock" data-initials="BA" data-color="#2563eb">BA</div>
    
    <div class="tile rock" data-initials="BA" data-color="#2563eb">BA</div>
    <div class="tile alt" data-initials="BJ" data-color="#dc2626">BJ</div>
    <div class="tile indie" data-initials="BR" data-color="#f97316">BR</div>
    <div class="tile metal" data-initials="BL" data-color="#64748b">BL</div>
    <div class="tile punk" data-initials="BL" data-color="#ec4899">BL</div>
    <div class="tile alt" data-initials="BO" data-color="#dc2626">BO</div>
    <div class="tile alt" data-initials="BO" data-color="#dc2626">BO</div>
    <div class="tile electronic" data-initials="BU" data-color="#22c55e">BU</div>
    
    <div class="tile pop" data-initials="CA" data-color="#06b6d4">CA</div>
    <div class="tile rock" data-initials="CH" data-color="#2563eb">CH</div>
    <div class="tile metal" data-initials="CO" data-color="#64748b">CO</div>
    <div class="tile indie" data-initials="CR" data-color="#f97316">CR</div>
    <div class="tile rock" data-initials="DA" data-color="#2563eb">DA</div>
    <div class="tile electronic" data-initials="DE" data-color="#22c55e">DE</div>
    <div class="tile newwave" data-initials="DI" data-color="#8b5cf6">DI</div>
    <div class="tile alt" data-initials="DO" data-color="#dc2626">DO</div>
  </div>

  <!-- Flying tile -->
  <div class="flying-tile" id="flyingTile" style="display: none;"></div>

  <!-- Close hint (outside wrapper so it's always centered) -->
  <div class="close-hint" id="closeHint">Click anywhere or press ESC to close</div>

  <!-- Gatefold overlay -->
  <div class="gatefold-overlay" id="gatefoldOverlay">
    <div class="gatefold-wrapper" id="gatefoldWrapper">
      <div class="gatefold">
        <!-- Right Panel (Spotify) - always there, hidden by cover when closed -->
        <div class="panel-right">
          <!-- Spine (visual element at the hinge) -->
          <div class="spine"></div>
          
          <div class="spotify-section">
            <div class="spotify-label">
              <svg class="spotify-icon" viewBox="0 0 24 24" fill="#1DB954">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
              Top Tracks
            </div>
            <div class="spotify-embed-container">
              <div class="mock-track-list">
                <div class="play-icon">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <div class="mock-track">
                  <span class="track-number">1</span>
                  <div class="track-art" id="trackArt1"></div>
                  <div class="track-info">
                    <div class="track-name">Wake Up</div>
                    <div class="track-artist">Arcade Fire</div>
                  </div>
                  <span class="track-duration">5:35</span>
                </div>
                <div class="mock-track">
                  <span class="track-number">2</span>
                  <div class="track-art" id="trackArt2"></div>
                  <div class="track-info">
                    <div class="track-name">Rebellion (Lies)</div>
                    <div class="track-artist">Arcade Fire</div>
                  </div>
                  <span class="track-duration">5:12</span>
                </div>
                <div class="mock-track">
                  <span class="track-number">3</span>
                  <div class="track-art" id="trackArt3"></div>
                  <div class="track-info">
                    <div class="track-name">The Suburbs</div>
                    <div class="track-artist">Arcade Fire</div>
                  </div>
                  <span class="track-duration">5:15</span>
                </div>
                <div class="mock-track">
                  <span class="track-number">4</span>
                  <div class="track-art" id="trackArt4"></div>
                  <div class="track-info">
                    <div class="track-name">Ready to Start</div>
                    <div class="track-artist">Arcade Fire</div>
                  </div>
                  <span class="track-duration">4:15</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- THE COVER - sits on top, opens to become left panel -->
        <div class="album-cover" id="albumCover">
          <!-- Front (album art - visible when closed) -->
          <div class="cover-front" id="coverFront"></div>
          
          <!-- Back (inside of cover - artist info, visible when opened) -->
          <div class="cover-back">
            <div class="artist-header">
              <div class="album-art-placeholder" id="coverBackArt">AF</div>
              <div class="artist-info">
                <h2 class="artist-name">Arcade Fire</h2>
                <p class="artist-meta">Indie Rock Â· 8 shows</p>
              </div>
            </div>
            
            <div class="concert-section">
              <div class="section-label">Concert History</div>
              <ul class="concert-list">
                <li class="concert-item">
                  <span class="concert-date">15 Sep 2024</span>
                  <span class="concert-venue">Hollywood Bowl</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">22 Mar 2023</span>
                  <span class="concert-venue">The Kia Forum</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">18 Oct 2022</span>
                  <span class="concert-venue">Greek Theatre</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">03 Aug 2018</span>
                  <span class="concert-venue">Hollywood Bowl</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">19 Jul 2017</span>
                  <span class="concert-venue">The Shrine</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">24 Apr 2014</span>
                  <span class="concert-venue">Coachella</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">12 Nov 2010</span>
                  <span class="concert-venue">Hollywood Palladium</span>
                </li>
                <li class="concert-item">
                  <span class="concert-date">08 Jun 2007</span>
                  <span class="concert-venue">The Wiltern</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="instructions">
    <strong>Click any tile</strong> to open the gatefold
    <div class="subtext">Cover opens like a book, becoming the left panel</div>
  </div>

  <script>
    const bgGrid = document.getElementById('bgGrid');
    const overlay = document.getElementById('gatefoldOverlay');
    const wrapper = document.getElementById('gatefoldWrapper');
    const flyingTile = document.getElementById('flyingTile');
    const coverFront = document.getElementById('coverFront');
    const coverBackArt = document.getElementById('coverBackArt');
    const closeHint = document.getElementById('closeHint');
    
    let isOpen = false;
    let isAnimating = false;
    let clickedTile = null;

    // Dimensions
    const PANEL_SIZE = 400;
    const SPINE_WIDTH = 12;
    const CLOSED_WIDTH = PANEL_SIZE; // Just the cover
    const OPEN_WIDTH = PANEL_SIZE + SPINE_WIDTH + PANEL_SIZE; // 812px

    function getClosedPosition() {
      // Center a 400px element
      return {
        left: (window.innerWidth - CLOSED_WIDTH) / 2,
        top: (window.innerHeight - PANEL_SIZE) / 2
      };
    }

    function getOpenPosition() {
      // Center the full 812px gatefold
      // But the wrapper's left edge should be where the opened cover's left edge will be
      // When open, the cover swings left, so wrapper needs to account for that
      return {
        left: (window.innerWidth - OPEN_WIDTH) / 2 + PANEL_SIZE, // +400 because cover opens to left
        top: (window.innerHeight - PANEL_SIZE) / 2
      };
    }

    function openGatefold(tile) {
      if (isAnimating || isOpen) return;
      isAnimating = true;
      isOpen = true;
      clickedTile = tile;

      const rect = tile.getBoundingClientRect();
      const initials = tile.dataset.initials;
      const color = tile.dataset.color;

      // Set colors
      const gradient = `linear-gradient(135deg, ${color} 0%, ${adjustColor(color, -30)} 100%)`;
      coverFront.style.background = gradient;
      coverFront.textContent = initials;
      coverBackArt.style.background = gradient;
      coverBackArt.textContent = initials;
      
      for (let i = 1; i <= 4; i++) {
        document.getElementById(`trackArt${i}`).style.background = gradient;
      }

      // Hide original tile
      tile.classList.add('hidden');

      // Set up flying tile at original position
      flyingTile.style.display = 'flex';
      flyingTile.style.left = rect.left + 'px';
      flyingTile.style.top = rect.top + 'px';
      flyingTile.style.width = rect.width + 'px';
      flyingTile.style.height = rect.height + 'px';
      flyingTile.style.background = gradient;
      flyingTile.style.fontSize = '1.8vw';
      flyingTile.style.borderRadius = '0';
      flyingTile.textContent = initials;
      flyingTile.style.transition = 'none';
      flyingTile.style.boxShadow = 'none';

      // Dim background
      bgGrid.classList.add('dimmed');

      // Get closed position (where tile should fly to)
      const closedPos = getClosedPosition();

      flyingTile.offsetHeight; // Force reflow

      // Animate tile to closed position (centered 400x400)
      flyingTile.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
      flyingTile.style.left = closedPos.left + 'px';
      flyingTile.style.top = closedPos.top + 'px';
      flyingTile.style.width = PANEL_SIZE + 'px';
      flyingTile.style.height = PANEL_SIZE + 'px';
      flyingTile.style.fontSize = '8rem';
      flyingTile.style.borderRadius = '4px';
      flyingTile.style.boxShadow = '0 25px 50px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3)';

      // After tile arrives, show gatefold and open cover
      setTimeout(() => {
        flyingTile.style.display = 'none';
        
        // Position wrapper at closed position initially
        wrapper.style.left = closedPos.left + 'px';
        wrapper.style.top = closedPos.top + 'px';
        wrapper.style.transition = 'none';
        
        overlay.classList.add('active');
        wrapper.classList.add('visible');
        
        wrapper.offsetHeight; // Force reflow
        
        // Now animate to open position while opening cover
        const openPos = getOpenPosition();
        wrapper.style.transition = 'left 0.8s cubic-bezier(0.4, 0, 0.2, 1), top 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
        wrapper.style.left = openPos.left + 'px';
        wrapper.style.top = openPos.top + 'px';
        
        // Small delay then open the cover
        setTimeout(() => {
          wrapper.classList.add('open');
          closeHint.classList.add('visible');
          isAnimating = false;
        }, 50);
      }, 500);
    }

    function closeGatefold() {
      if (isAnimating || !isOpen) return;
      isAnimating = true;

      // Hide close hint
      closeHint.classList.remove('visible');

      // Close the cover and move wrapper back to closed position
      wrapper.classList.remove('open');
      const closedPos = getClosedPosition();
      wrapper.style.left = closedPos.left + 'px';
      wrapper.style.top = closedPos.top + 'px';

      // After cover closes, animate tile back
      setTimeout(() => {
        wrapper.classList.remove('visible');
        overlay.classList.remove('active');

        if (clickedTile) {
          const rect = clickedTile.getBoundingClientRect();

          // Show flying tile at closed position
          flyingTile.style.transition = 'none';
          flyingTile.style.left = closedPos.left + 'px';
          flyingTile.style.top = closedPos.top + 'px';
          flyingTile.style.width = PANEL_SIZE + 'px';
          flyingTile.style.height = PANEL_SIZE + 'px';
          flyingTile.style.fontSize = '8rem';
          flyingTile.style.borderRadius = '4px';
          flyingTile.style.display = 'flex';

          flyingTile.offsetHeight; // Force reflow

          // Animate back to grid
          flyingTile.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
          flyingTile.style.left = rect.left + 'px';
          flyingTile.style.top = rect.top + 'px';
          flyingTile.style.width = rect.width + 'px';
          flyingTile.style.height = rect.height + 'px';
          flyingTile.style.fontSize = '1.8vw';
          flyingTile.style.borderRadius = '0';
          flyingTile.style.boxShadow = 'none';

          setTimeout(() => {
            flyingTile.style.display = 'none';
            clickedTile.classList.remove('hidden');
            bgGrid.classList.remove('dimmed');
            isOpen = false;
            isAnimating = false;
            clickedTile = null;
          }, 400);
        } else {
          bgGrid.classList.remove('dimmed');
          isOpen = false;
          isAnimating = false;
        }
      }, 800);
    }

    function adjustColor(hex, amount) {
      const num = parseInt(hex.replace('#', ''), 16);
      const r = Math.min(255, Math.max(0, (num >> 16) + amount));
      const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
      const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
      return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
    }

    // Event listeners
    document.querySelectorAll('.tile').forEach(tile => {
      tile.addEventListener('click', () => openGatefold(tile));
    });

    overlay.addEventListener('click', (e) => {
      if (e.target === overlay || e.target.closest('.gatefold-wrapper')) {
        closeGatefold();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeGatefold();
      }
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      if (isOpen && !isAnimating) {
        const openPos = getOpenPosition();
        wrapper.style.transition = 'none';
        wrapper.style.left = openPos.left + 'px';
        wrapper.style.top = openPos.top + 'px';
      }
    });
  </script>
</body>
</html>
